<!--
 * @Author: liuxinye
 * @Date: 2020-05-12 17:28:06
 * @LastEditors: liuxinye
 * @LastEditTime: 2020-05-14 18:22:45
 * @Description: 
 -->
<!DOCTYPE html>
<html>
    <head>
       <title>滚动条设置详解</title>
       <style>
          #scroll_container{
              height: 500px;
              width: 500px;
              overflow-y: scroll;
              padding: 50px;
          }
          .scroll_item{
              height: 200px;
              width: 500px;
              margin-top: 20px;
              background-color: aquamarine;
              display: flex;
              align-items: center;
              justify-content: center;
          }
       </style>
    </head>
    <body>
       <div  id="scroll_container">
           <div id="item1" class="scroll_item">
               <span>1</span>
           </div>
           <div id="item2" class="scroll_item">
                <span>2</span>
            </div>
            <div id="item3" class="scroll_item">
                <span>3</span>
            </div>
            <div id="item4" class="scroll_item">
                <span>4</span>
            </div>
       </div>
       <button onclick="addItem()">添加一个元素</button>
       <input type="number" placeholder="请输入要滚动到的元素index" style="width: 200px;"/>
       <button onclick="scrollToIndex()">滚动到指定元素</button>
    </body>
    <script>
        let container=document.getElementById("scroll_container");
       
        // let lastChild=document.getElementById("last");
        let index=4;
        // container.scrollTo(0,container.scrollHeight-container.clientHeight)//IOS 手机 不兼容
        // container.scrollTop=container.scrollHeight-container.clientHeight;
        // console.log(container.scrollHeight-container.clientHeight);
        // console.log(container.clientHeight);//包含padding的高度
        // console.log(container.offsetHeight);//包含padding的高度
        // console.log(container.getBoundingClientRect());//包含padding的高度
        function addItem(){
            index+=1;
            let item=`<div id="${'item'+index}" class="scroll_item">
                            <span>${index}</span>
                        </div>`;
            container.innerHTML+=item;  
            setTimeout(()=>{
                scrollToIndex();
            })
           
         }
         function scrollToIndex(){
            let input=document.getElementsByTagName('input')[0];
            let id='item'+input.value;
            if(!input.value){
                id='item'+index;
            }
            let item=document.getElementById(id);
            //scrollTo实现,因为item.getBoundingClientRect().top子元素顶部是相对于视口顶部距离差
            //，因此需要加上内容的偏移量scrollTop
            // let top=item.getBoundingClientRect().top;
            // dy=top;
            // if(top!=0){
            //     top+=container.scrollTop;
            //     // container.scrollTo(0,top)
            // }
            // value=container.scrollTop;
            // scrollTo(container,0,top,1000)
            //scrollBy实现,
            // container.scrollBy(0,item.getBoundingClientRect().top)
            // value=0;
            // scrollBy(container,0,item.getBoundingClientRect().top,1000);
            //scrollTop实现
            //滚动到底部
            // container.scrollTop=container.scrollHeight-container.clientHeight;
            let top=item.getBoundingClientRect().top;
            dy=top;
            if(top!=0){
                value=
                top+=container.scrollTop;
                // container.scrollTop=top;
                scroll(container,top,500)
            }
         }
         let dy=0;//根据偏移量控制速度
         let value=0;
         function scrollBy(el,x,y,duration){ 
                let step=y*24/duration
                value+=step;
                console.log(value,y)
                if((y>0&&value>y)||(y<0&&value<y))
                  return;
                el.scrollBy(x,step);
                requestAnimationFrame(scrollBy.bind(null,el,x,y,duration));
         }
         function scrollTo(el,x,y,duration){ 
                let step=dy*24/duration
                value+=step;
                console.log(value,y)
                if((step>0&&value>y)||(step<0&&value<y))
                  return;
                el.scrollTo(x,value);
                requestAnimationFrame(scrollTo.bind(null,el,x,y,duration));
         }
         function scroll(el,y,duration){   
                let step=dy*24/duration
                value+=step;
                console.log(value,y,step)
                if((step>0&&value>y)||(step<0&&value<y))
                  return;
                el.scrollTop=value;
                requestAnimationFrame(scroll.bind(null,el,y,duration));
         }
    </script>
</html>